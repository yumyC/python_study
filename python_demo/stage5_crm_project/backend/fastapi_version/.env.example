# FastAPI CRM 系统环境变量配置示例
# 复制此文件为 .env 并根据实际情况修改配置

# ================================
# 应用基础配置
# ================================
APP_NAME="CRM System"
APP_VERSION="1.0.0"
DEBUG=false
ENVIRONMENT="production"
SECRET_KEY="your-super-secret-key-change-in-production-please"

# 服务器配置
HOST="0.0.0.0"
PORT=8000
WORKERS=4

# ================================
# 数据库配置
# ================================
# SQLite (开发环境)
# DATABASE_URL="sqlite:///./crm_fastapi.db"

# PostgreSQL (生产环境推荐)
DATABASE_URL="postgresql://crm_user:crm_password@postgres:5432/crm_db"

# MySQL (可选)
# DATABASE_URL="mysql+pymysql://crm_user:crm_password@mysql:3306/crm_db"

# 数据库连接池配置
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# ================================
# Redis 配置
# ================================
REDIS_URL="redis://:redis_password@redis:6379/0"
REDIS_MAX_CONNECTIONS=20
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ================================
# JWT 认证配置
# ================================
JWT_SECRET_KEY="your-jwt-secret-key-change-in-production"
JWT_ALGORITHM="HS256"
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=120
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
JWT_ISSUER="crm-system"
JWT_AUDIENCE="crm-users"

# ================================
# 密码安全配置
# ================================
PASSWORD_HASH_ALGORITHM="bcrypt"
PASSWORD_HASH_ROUNDS=12
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=false

# ================================
# 文件上传配置
# ================================
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE=10485760  # 10MB
ALLOWED_FILE_TYPES="jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx,zip"
UPLOAD_CHUNK_SIZE=8192
FILE_URL_EXPIRE_HOURS=24

# ================================
# Celery 异步任务配置
# ================================
CELERY_BROKER_URL="redis://:redis_password@redis:6379/0"
CELERY_RESULT_BACKEND="redis://:redis_password@redis:6379/0"
CELERY_TASK_SERIALIZER="json"
CELERY_RESULT_SERIALIZER="json"
CELERY_ACCEPT_CONTENT=["json"]
CELERY_TIMEZONE="Asia/Shanghai"
CELERY_ENABLE_UTC=true
CELERY_TASK_TRACK_STARTED=true
CELERY_TASK_TIME_LIMIT=300  # 5分钟
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# ================================
# 邮件配置
# ================================
SMTP_ENABLED=false
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER="your-email@gmail.com"
SMTP_PASSWORD="your-app-password"
SMTP_TLS=true
SMTP_SSL=false
SMTP_FROM_NAME="CRM System"
SMTP_FROM_EMAIL="noreply@crm-system.com"

# ================================
# 日志配置
# ================================
LOG_LEVEL="INFO"
LOG_FILE="./logs/app.log"
LOG_MAX_SIZE=10485760  # 10MB
LOG_BACKUP_COUNT=5
LOG_FORMAT="%(asctime)s - %(name)s - %(levelname)s - [%(filename)s:%(lineno)d] - %(message)s"
LOG_DATE_FORMAT="%Y-%m-%d %H:%M:%S"
LOG_JSON_FORMAT=false

# 访问日志
ACCESS_LOG_ENABLED=true
ACCESS_LOG_FILE="./logs/access.log"

# 错误日志
ERROR_LOG_ENABLED=true
ERROR_LOG_FILE="./logs/error.log"

# ================================
# 跨域配置
# ================================
CORS_ENABLED=true
CORS_ORIGINS="http://localhost:3000,http://localhost:8080,https://your-frontend-domain.com"
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS="GET,POST,PUT,DELETE,OPTIONS,PATCH"
CORS_ALLOW_HEADERS="*"
CORS_MAX_AGE=86400

# ================================
# 安全配置
# ================================
ALLOWED_HOSTS="localhost,127.0.0.1,your-domain.com"
SECURE_COOKIES=false  # 生产环境设为 true
SECURE_HEADERS=true
HTTPS_ONLY=false  # 生产环境设为 true
HSTS_MAX_AGE=31536000
CONTENT_SECURITY_POLICY="default-src 'self'"

# ================================
# 限流配置
# ================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_LOGIN_ATTEMPTS=5
RATE_LIMIT_UPLOAD_ATTEMPTS=10
RATE_LIMIT_EXPORT_ATTEMPTS=5

# ================================
# 监控配置
# ================================
ENABLE_METRICS=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30
PERFORMANCE_MONITORING=true
ERROR_TRACKING=true

# Prometheus 配置
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=8001

# ================================
# 缓存配置
# ================================
CACHE_ENABLED=true
CACHE_TTL=3600  # 1小时
CACHE_MAX_SIZE=1000
CACHE_KEY_PREFIX="crm:"

# 用户会话缓存
USER_SESSION_TTL=7200  # 2小时
MENU_CACHE_TTL=1800   # 30分钟
PERMISSION_CACHE_TTL=1800  # 30分钟

# ================================
# 业务配置
# ================================
# 分页配置
DEFAULT_PAGE_SIZE=20
MAX_PAGE_SIZE=100

# 导出配置
EXPORT_MAX_RECORDS=10000
EXPORT_TIMEOUT=300  # 5分钟

# 工作日志配置
WORKLOG_MAX_CONTENT_LENGTH=2000
WORKLOG_RATING_MIN=1
WORKLOG_RATING_MAX=5

# ================================
# 第三方服务配置
# ================================
# 阿里云 OSS (可选)
OSS_ENABLED=false
OSS_ACCESS_KEY_ID="your-access-key"
OSS_ACCESS_KEY_SECRET="your-secret-key"
OSS_BUCKET="your-bucket"
OSS_ENDPOINT="oss-cn-hangzhou.aliyuncs.com"
OSS_DOMAIN="https://your-bucket.oss-cn-hangzhou.aliyuncs.com"

# 腾讯云 COS (可选)
COS_ENABLED=false
COS_SECRET_ID="your-secret-id"
COS_SECRET_KEY="your-secret-key"
COS_REGION="ap-beijing"
COS_BUCKET="your-bucket"

# 七牛云 (可选)
QINIU_ENABLED=false
QINIU_ACCESS_KEY="your-access-key"
QINIU_SECRET_KEY="your-secret-key"
QINIU_BUCKET="your-bucket"
QINIU_DOMAIN="https://your-domain.com"

# ================================
# 消息推送配置
# ================================
# 微信企业号 (可选)
WECHAT_WORK_ENABLED=false
WECHAT_WORK_CORP_ID="your-corp-id"
WECHAT_WORK_AGENT_ID="your-agent-id"
WECHAT_WORK_SECRET="your-secret"

# 钉钉 (可选)
DINGTALK_ENABLED=false
DINGTALK_APP_KEY="your-app-key"
DINGTALK_APP_SECRET="your-app-secret"
DINGTALK_AGENT_ID="your-agent-id"

# 飞书 (可选)
FEISHU_ENABLED=false
FEISHU_APP_ID="your-app-id"
FEISHU_APP_SECRET="your-app-secret"

# ================================
# 开发调试配置
# ================================
# 开发模式
DEV_MODE=false
DEBUG_SQL=false
DEBUG_REDIS=false
DEBUG_CELERY=false

# 测试配置
TEST_DATABASE_URL="sqlite:///./test_crm.db"
TEST_REDIS_URL="redis://localhost:6379/1"

# API 文档配置
DOCS_ENABLED=true
DOCS_URL="/docs"
REDOC_URL="/redoc"
OPENAPI_URL="/openapi.json"

# ================================
# Docker 配置
# ================================
# 容器内部配置
CONTAINER_MODE=false
DOCKER_NETWORK="crm_network"

# 健康检查
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH="/health"

# ================================
# 备份配置
# ================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE="0 2 * * *"  # 每天凌晨2点
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_PATH="./backups"

# ================================
# 国际化配置
# ================================
DEFAULT_LANGUAGE="zh-CN"
SUPPORTED_LANGUAGES="zh-CN,en-US"
TIMEZONE="Asia/Shanghai"

# ================================
# 性能配置
# ================================
# 数据库查询优化
QUERY_TIMEOUT=30
SLOW_QUERY_THRESHOLD=1.0

# 并发配置
MAX_CONCURRENT_REQUESTS=1000
REQUEST_TIMEOUT=30

# 内存配置
MAX_MEMORY_USAGE="512MB"
MEMORY_THRESHOLD=80